buffered_mb_sf <- st_as_sf(mb_sf$MB_CODE21, buffered)
buffered_mb_sf <- st_sf(mb_sf$MB_CODE21, buffered)
View(buffered_mb_sf)
buffered_mb_sf <- st_sf(mb_sf$MB_CODE21, geometry = st_as_sfc(buffered))
View(buffered_mb_sf)
View(buffered_mb_sf)
mb_sf$MB_CODE21
View(buffered_mb_sf)
buffered_mb_sf <- st_sf(MB_CODE21 =  mb_sf$MB_CODE21, geometry = st_as_sfc(buffered))
joined_buffered_mb_sf <- buffered_mb_sf %>% st_join(stops_sf)
View(joined_buffered_mb_sf)
colnames(joined_buffered_mb_sf)
joined_buffered_mb_sf <- buffered_mb_sf %>%
st_join(stops_sf) %>% select(c(MB_CODE21, stop_id, geometry))
?nest
joined_buffered_mb_sf %>%
st_drop_geometry() %>%
nest(.by = 'MB_CODE21')
joined_buffered_mb_df = joined_buffered_mb_sf %>%
st_drop_geometry() %>%
nest(.by = 'MB_CODE21')
View(joined_buffered_mb_df)
joined_buffered_mb_df = joined_buffered_mb_sf %>%
st_drop_geometry() %>%
group_by(MB_CODE21) %>%
summarise(stops_inside = list(stop_id))
View(joined_buffered_mb_df)
#convert to hash-table
mb_to_stops = setNames(joined_buffered_mb_df$MB_CODE21, joined_buffered_mb_df$stops_inside)
View(joined_buffered_mb_df)
mb_to_stops['20015400000']
#convert to hash-table
mb_to_stops = setNames(joined_buffered_mb_df$stops_inside, joined_buffered_mb_df$MB_CODE21)
mb_to_stops['20015400000']
synfaxgtfs::generate_isochrone('14315')
joined_buffered_mb_df[1,]$stops_inside
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
synfaxgtfs::generate_isochrone(joined_buffered_mb_df[1,]$stops_inside)
synfaxgtfs::generate_isochrone('14315')
synfaxgtfs::generate_isochrone(as.character('14315'))
fwrite(synfaxgtfs:::.pkgenv$place_registry, 'place_registry.csv')
library(data.table)
fwrite(synfaxgtfs:::.pkgenv$place_registry, 'place_registry.csv')
saveRDS(synfaxgtfs:::.pkgenv$place_registry, 'place_registry.Rdata')
pr  = synfaxgtfs:::.pkgenv$place_registry
current_stop_id = '14315'
current_stop_id = as.character(start_stop_id)
current_station_name = synfaxgtfs:::.pkgenv$stop_id_to_name[as.character(current_stop_id)]
synfaxgtfs:::.pkgenv$stop_id_to_name
gtfs_parameters =  list(mode_numbers = unname(unlist(synfaxgtfs::get_settings('mode_numbers'))),
day =  unname(unlist(synfaxgtfs::get_settings('day'))),
city = unname(unlist(synfaxgtfs::get_settings('city'))))
isochrone_params = list(start_time_ = synfaxgtfs::get_settings('start_time_')[[1]][1],
time_limit_ = synfaxgtfs::get_settings('time_limit_')[[1]][1],
xfer_penalty_ = synfaxgtfs::get_settings('xfer_penalty_')[[1]][1] )
#preload
synfaxgtfs:::.preload_isochrone_data(gtfs_parameters, isochrone_params)
current_stop_id = as.character(start_stop_id)
current_station_name = synfaxgtfs:::.pkgenv$stop_id_to_name[as.character(current_stop_id)]
arrival_times <- (synfaxgtfs:::.pkgenv$arrival_time_dict[current_stop_id][[1]])
arrival_times = as.character(as.numeric(as.duration(isochrone_params$time_limit_ - arrival_times), 'minutes'))
arrival_times <- (synfaxgtfs:::.pkgenv$arrival_time_dict[current_stop_id][[1]])
isochrone_params$time_limit_
arrival_times
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
#synfax gtfs
gtfs_parameters =  list(mode_numbers = unname(unlist(synfaxgtfs::get_settings('mode_numbers'))),
day =  unname(unlist(synfaxgtfs::get_settings('day'))),
city = unname(unlist(synfaxgtfs::get_settings('city'))))
isochrone_params = list(start_time_ = synfaxgtfs::get_settings('start_time_')[[1]][1],
time_limit_ = synfaxgtfs::get_settings('time_limit_')[[1]][1],
xfer_penalty_ = synfaxgtfs::get_settings('xfer_penalty_')[[1]][1] )
#preload
synfaxgtfs:::.preload_isochrone_data(gtfs_parameters, isochrone_params)
#get stops list
gtfs_pre_stops <- as.character(synfaxgtfs::get_stops_in_gtfs_pre())
#get stops sf
stops_sf <- synfaxgtfs::get_stops_sf() %>%
mutate(stop_id = as.character(stop_id)) %>%
filter(stop_id %in% gtfs_pre_stops)
#load dwelling_data
dwelling_data = st_read('~/Documents/r_projects/shapefiles/melbourne_dwelling_data.gpkg')
dwelling_sa1s = unique(dwelling_data$sa1_code_2021)
#load mesh block geometries
mb_sf <- read_sf('~/Documents/r_projects/shapefiles/MB_2021_AUST_SHP_GDA2020/MB_2021_AUST_GDA2020.shp') %>%
filter(GCC_NAME21 == "Greater Melbourne", SA1_CODE21 %in% dwelling_sa1s )
#buffer mesh blocks
buffered <- mb_sf %>%
s2::as_s2_geography() %>%
s2_buffer_cells(distance = 450, max_cells = 50)
#re-integrate with  stop_id
buffered_mb_sf <- st_sf(MB_CODE21 =  mb_sf$MB_CODE21, geometry = st_as_sfc(buffered))
#join to stops
joined_buffered_mb_sf <- buffered_mb_sf %>%
st_join(stops_sf) %>% select(c(MB_CODE21, stop_id, geometry))
#convert to df
joined_buffered_mb_df = joined_buffered_mb_sf %>%
st_drop_geometry() %>%
group_by(MB_CODE21) %>%
summarise(stops_inside = list(stop_id))
#convert to hash-table
#this says, for any given MB, which stops can I access?
mb_to_stops = setNames(joined_buffered_mb_df$stops_inside, joined_buffered_mb_df$MB_CODE21)
test <- synfaxgtfs::generate_isochrone(as.character('14315'))
pr  = synfaxgtfs:::.pkgenv$place_registry
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
gtfs_parameters =  list(mode_numbers = unname(unlist(synfaxgtfs::get_settings('mode_numbers'))),
day =  unname(unlist(synfaxgtfs::get_settings('day'))),
city = unname(unlist(synfaxgtfs::get_settings('city'))))
isochrone_params = list(start_time_ = synfaxgtfs::get_settings('start_time_')[[1]][1],
time_limit_ = synfaxgtfs::get_settings('time_limit_')[[1]][1],
xfer_penalty_ = synfaxgtfs::get_settings('xfer_penalty_')[[1]][1] )
#preload
synfaxgtfs:::.preload_isochrone_data(gtfs_parameters, isochrone_params)
test <- synfaxgtfs::generate_isochrone(as.character('14315'), pr)
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
#synfax gtfs
gtfs_parameters =  list(mode_numbers = unname(unlist(synfaxgtfs::get_settings('mode_numbers'))),
day =  unname(unlist(synfaxgtfs::get_settings('day'))),
city = unname(unlist(synfaxgtfs::get_settings('city'))))
isochrone_params = list(start_time_ = synfaxgtfs::get_settings('start_time_')[[1]][1],
time_limit_ = synfaxgtfs::get_settings('time_limit_')[[1]][1],
xfer_penalty_ = synfaxgtfs::get_settings('xfer_penalty_')[[1]][1] )
#preload
synfaxgtfs:::.preload_isochrone_data(gtfs_parameters, isochrone_params)
test <- synfaxgtfs::generate_isochrone(as.character('14315'), pr)
rm(pr)
starting_stop = '14315'
isochrone_results <- synfaxgtfs::generate_isochrone(as.character(starting_stop))
isochrone_results <- synfaxgtfs::generate_isochrone(as.character(starting_stop), NULL)
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
isochrone_results <- synfaxgtfs::generate_isochrone(as.character(starting_stop))
synfaxgtfs:::.pkgenv$stop_id_to_name
errors
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
#synfax gtfs
#get stops list
gtfs_pre_stops <- as.character(synfaxgtfs::get_stops_in_gtfs_pre())
#get stops sf
stops_sf <- synfaxgtfs::get_stops_sf() %>%
mutate(stop_id = as.character(stop_id)) %>%
filter(stop_id %in% gtfs_pre_stops)
synfaxgtfs:::.preload_isochrone_data()
gtfs_parameters =  list(mode_numbers = unname(unlist(synfaxgtfs::get_settings('mode_numbers'))),
day =  unname(unlist(synfaxgtfs::get_settings('day'))),
city = unname(unlist(synfaxgtfs::get_settings('city'))))
isochrone_params = list(start_time_ = synfaxgtfs::get_settings('start_time_')[[1]][1],
time_limit_ = synfaxgtfs::get_settings('time_limit_')[[1]][1],
xfer_penalty_ = synfaxgtfs::get_settings('xfer_penalty_')[[1]][1] )
synfaxgtfs:::.preload_isochrone_data()
synfaxgtfs:::.preload_isochrone_data(gtfs_parameters, isochrone_params)
#get stops list
gtfs_pre_stops <- as.character(synfaxgtfs::get_stops_in_gtfs_pre())
#get stops sf
stops_sf <- synfaxgtfs::get_stops_sf() %>%
mutate(stop_id = as.character(stop_id)) %>%
filter(stop_id %in% gtfs_pre_stops)
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
et stops list
#get stops list
gtfs_pre_stops <- as.character(synfaxgtfs::get_stops_in_gtfs_pre())
#get stops sf
stops_sf <- synfaxgtfs::get_stops_sf() %>%
mutate(stop_id = as.character(stop_id)) %>%
filter(stop_id %in% gtfs_pre_stops)
#load dwelling_data
dwelling_data = st_read('~/Documents/r_projects/shapefiles/melbourne_dwelling_data.gpkg')
dwelling_sa1s = unique(dwelling_data$sa1_code_2021)
#load mesh block geometries
mb_sf <- read_sf('~/Documents/r_projects/shapefiles/MB_2021_AUST_SHP_GDA2020/MB_2021_AUST_GDA2020.shp') %>%
filter(GCC_NAME21 == "Greater Melbourne", SA1_CODE21 %in% dwelling_sa1s )
#buffer mesh blocks
buffered <- mb_sf %>%
s2::as_s2_geography() %>%
s2_buffer_cells(distance = 450, max_cells = 50)
#re-integrate with  stop_id
buffered_mb_sf <- st_sf(MB_CODE21 =  mb_sf$MB_CODE21, geometry = st_as_sfc(buffered))
#join to stops
joined_buffered_mb_sf <- buffered_mb_sf %>%
st_join(stops_sf) %>% select(c(MB_CODE21, stop_id, geometry))
#convert to df
joined_buffered_mb_df = joined_buffered_mb_sf %>%
st_drop_geometry() %>%
group_by(MB_CODE21) %>%
summarise(stops_inside = list(stop_id))
#convert to hash-table
#this says, for any given MB, which stops can I access?
mb_to_stops = setNames(joined_buffered_mb_df$stops_inside, joined_buffered_mb_df$MB_CODE21)
test <- synfaxgtfs::generate_isochrone(as.character('14315'))
synfaxgtfs:::run_iteration()
synfaxgtfs:::run_iteration
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
synfaxgtfs:::run_iteration
gtfs_parameters =  list(mode_numbers = unname(unlist(synfaxgtfs::get_settings('mode_numbers'))),
day =  unname(unlist(synfaxgtfs::get_settings('day'))),
city = unname(unlist(synfaxgtfs::get_settings('city'))))
isochrone_params = list(start_time_ = synfaxgtfs::get_settings('start_time_')[[1]][1],
time_limit_ = synfaxgtfs::get_settings('time_limit_')[[1]][1],
xfer_penalty_ = synfaxgtfs::get_settings('xfer_penalty_')[[1]][1] )
synfaxgtfs:::.preload_isochrone_data()
gtfs_parameters =  list(mode_numbers = unname(unlist(synfaxgtfs::get_settings('mode_numbers'))),
day =  unname(unlist(synfaxgtfs::get_settings('day'))),
city = unname(unlist(synfaxgtfs::get_settings('city'))))
isochrone_params = list(start_time_ = synfaxgtfs::get_settings('start_time_')[[1]][1],
time_limit_ = synfaxgtfs::get_settings('time_limit_')[[1]][1],
xfer_penalty_ = synfaxgtfs::get_settings('xfer_penalty_')[[1]][1] )
synfaxgtfs:::.preload_isochrone_data(gtfs_parameters, isochrone_params)
#get stops list
gtfs_pre_stops <- as.character(synfaxgtfs::get_stops_in_gtfs_pre())
#get stops sf
stops_sf <- synfaxgtfs::get_stops_sf() %>%
mutate(stop_id = as.character(stop_id)) %>%
filter(stop_id %in% gtfs_pre_stops)
#load dwelling_data
dwelling_data = st_read('~/Documents/r_projects/shapefiles/melbourne_dwelling_data.gpkg')
dwelling_sa1s = unique(dwelling_data$sa1_code_2021)
#load mesh block geometries
mb_sf <- read_sf('~/Documents/r_projects/shapefiles/MB_2021_AUST_SHP_GDA2020/MB_2021_AUST_GDA2020.shp') %>%
filter(GCC_NAME21 == "Greater Melbourne", SA1_CODE21 %in% dwelling_sa1s )
#buffer mesh blocks
buffered <- mb_sf %>%
s2::as_s2_geography() %>%
s2_buffer_cells(distance = 450, max_cells = 50)
#re-integrate with  stop_id
buffered_mb_sf <- st_sf(MB_CODE21 =  mb_sf$MB_CODE21, geometry = st_as_sfc(buffered))
#join to stops
joined_buffered_mb_sf <- buffered_mb_sf %>%
st_join(stops_sf) %>% select(c(MB_CODE21, stop_id, geometry))
#convert to df
joined_buffered_mb_df = joined_buffered_mb_sf %>%
st_drop_geometry() %>%
group_by(MB_CODE21) %>%
summarise(stops_inside = list(stop_id))
#convert to hash-table
#this says, for any given MB, which stops can I access?
mb_to_stops = setNames(joined_buffered_mb_df$stops_inside, joined_buffered_mb_df$MB_CODE21)
test <- synfaxgtfs::generate_isochrone(as.character('14315'))
rlang::last_trace()
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
#synfax gtfs
gtfs_parameters =  list(mode_numbers = unname(unlist(synfaxgtfs::get_settings('mode_numbers'))),
day =  unname(unlist(synfaxgtfs::get_settings('day'))),
city = unname(unlist(synfaxgtfs::get_settings('city'))))
isochrone_params = list(start_time_ = synfaxgtfs::get_settings('start_time_')[[1]][1],
time_limit_ = synfaxgtfs::get_settings('time_limit_')[[1]][1],
xfer_penalty_ = synfaxgtfs::get_settings('xfer_penalty_')[[1]][1] )
synfaxgtfs:::.preload_isochrone_data(gtfs_parameters, isochrone_params)
#get stops list
gtfs_pre_stops <- as.character(synfaxgtfs::get_stops_in_gtfs_pre())
#get stops sf
stops_sf <- synfaxgtfs::get_stops_sf() %>%
mutate(stop_id = as.character(stop_id)) %>%
filter(stop_id %in% gtfs_pre_stops)
#load dwelling_data
dwelling_data = st_read('~/Documents/r_projects/shapefiles/melbourne_dwelling_data.gpkg')
dwelling_sa1s = unique(dwelling_data$sa1_code_2021)
dwelling_sa2s = unique(dwelling_data$sa2_code_2021)
#employment
#load dzn geographies
dzns_sf <- read_sf('~/Documents/r_projects/shapefiles/DZN_2021_AUST_GDA2020_SHP/DZN_2021_AUST_GDA2020.shp') %>%
filter(SA2_CODE21 %in% dwelling_sa2s)
#load csv
employment_dzn = read.csv('employment_dzn.csv', skip = 10) %>%
rename(DZN_CODE21 = "X1.digit.level.OCCP.Occupation", total_employment = 'Total') %>%
select(DZN_CODE21, total_employment) %>%
mutate(DZN_CODE21 = as.character(DZN_CODE21))
dzns_sf = dzns_sf %>%
left_join(employment_dzn, by = 'DZN_CODE21') %>%
st_transform('wgs84') %>%
select(DZN_CODE21, AREASQKM21, total_employment)
#load mesh block geometries
mb_sf <- read_sf('~/Documents/r_projects/shapefiles/MB_2021_AUST_SHP_GDA2020/MB_2021_AUST_GDA2020.shp') %>%
filter(GCC_NAME21 == "Greater Melbourne", SA1_CODE21 %in% dwelling_sa1s )
#buffer mesh blocks
buffered <- mb_sf %>%
s2::as_s2_geography() %>%
s2_buffer_cells(distance = 450, max_cells = 50)
#re-integrate with  stop_id
buffered_mb_sf <- st_sf(MB_CODE21 =  mb_sf$MB_CODE21, geometry = st_as_sfc(buffered))
#join to stops
joined_buffered_mb_sf <- buffered_mb_sf %>%
st_join(stops_sf) %>% select(c(MB_CODE21, stop_id, geometry))
#convert to df
joined_buffered_mb_df = joined_buffered_mb_sf %>%
st_drop_geometry() %>%
group_by(MB_CODE21) %>%
summarise(stops_inside = list(stop_id))
#convert to hash-table
#this says, for any given MB, which stops can I access?
mb_to_stops = setNames(joined_buffered_mb_df$stops_inside, joined_buffered_mb_df$MB_CODE21)
test <- synfaxgtfs::generate_isochrone(as.character('14315'))
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
gtfs_parameters =  list(mode_numbers = unname(unlist(synfaxgtfs::get_settings('mode_numbers'))),
day =  unname(unlist(synfaxgtfs::get_settings('day'))),
city = unname(unlist(synfaxgtfs::get_settings('city'))))
isochrone_params = list(start_time_ = synfaxgtfs::get_settings('start_time_')[[1]][1],
time_limit_ = synfaxgtfs::get_settings('time_limit_')[[1]][1],
xfer_penalty_ = synfaxgtfs::get_settings('xfer_penalty_')[[1]][1] )
synfaxgtfs:::.preload_isochrone_data(gtfs_parameters, isochrone_params)
synfaxgtfs:::load_places_registry(isochrone_params)
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
#synfax gtfs
gtfs_parameters =  list(mode_numbers = unname(unlist(synfaxgtfs::get_settings('mode_numbers'))),
day =  unname(unlist(synfaxgtfs::get_settings('day'))),
city = unname(unlist(synfaxgtfs::get_settings('city'))))
isochrone_params = list(start_time_ = synfaxgtfs::get_settings('start_time_')[[1]][1],
time_limit_ = synfaxgtfs::get_settings('time_limit_')[[1]][1],
xfer_penalty_ = synfaxgtfs::get_settings('xfer_penalty_')[[1]][1] )
synfaxgtfs:::.preload_isochrone_data(gtfs_parameters, isochrone_params)
unique_stops = (unique(.pkgenv$gtfs_prefilter$stop_id))
unique_stops = (unique(synfaxgtfs:::.pkgenv$gtfs_prefilter$stop_id))
arrival_time_dict = synfaxgtfs:::.pkgenv$arrival_time_dict
load_places_registry_parallel(unique_stops, isochrone_params, arrival_time_dict)
synfaxgtfs::place_registry(unique_stops, isochrone_params, arrival_time_dict)
xyz <- synfaxgtfs:::.pkgenv$place_registry
xyz[1]
xyz['11198']
test <- synfaxgtfs::run_iteration('14315', isochrone_params)
View(xyz)
synfaxgtfs::place_registry()
synfaxgtfs::place_registry
View(arrival_time_dict)
synfaxgtfs::place_registry(unique_stops, isochrone_params, arrival_time_dict)
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
synfaxgtfs::place_registry
gtfs_parameters =  list(mode_numbers = unname(unlist(synfaxgtfs::get_settings('mode_numbers'))),
day =  unname(unlist(synfaxgtfs::get_settings('day'))),
city = unname(unlist(synfaxgtfs::get_settings('city'))))
isochrone_params = list(start_time_ = synfaxgtfs::get_settings('start_time_')[[1]][1],
time_limit_ = synfaxgtfs::get_settings('time_limit_')[[1]][1],
xfer_penalty_ = synfaxgtfs::get_settings('xfer_penalty_')[[1]][1] )
synfaxgtfs:::.preload_isochrone_data(gtfs_parameters, isochrone_params)
unique_stops = (unique(synfaxgtfs:::.pkgenv$gtfs_prefilter$stop_id))
arrival_time_dict = synfaxgtfs:::.pkgenv$arrival_time_dict
synfaxgtfs::place_registry(unique_stops, isochrone_params, arrival_time_dict)
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
#synfax gtfs
gtfs_parameters =  list(mode_numbers = unname(unlist(synfaxgtfs::get_settings('mode_numbers'))),
day =  unname(unlist(synfaxgtfs::get_settings('day'))),
city = unname(unlist(synfaxgtfs::get_settings('city'))))
isochrone_params = list(start_time_ = synfaxgtfs::get_settings('start_time_')[[1]][1],
time_limit_ = synfaxgtfs::get_settings('time_limit_')[[1]][1],
xfer_penalty_ = synfaxgtfs::get_settings('xfer_penalty_')[[1]][1] )
synfaxgtfs:::.preload_isochrone_data(gtfs_parameters, isochrone_params)
unique_stops = (unique(synfaxgtfs:::.pkgenv$gtfs_prefilter$stop_id))
arrival_time_dict = synfaxgtfs:::.pkgenv$arrival_time_dict
.pkgenv = synfaxgtfs:::.pkgenv
place_registry(unique_stops, isochrone_params, arrival_time_dict)
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
synfaxgtfs::place_registry == place_registry
synfaxgtfs::place_registry
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
library(future)
library(furrr)
synfaxgtfs::load_place_registry
gtfs_parameters =  list(mode_numbers = unname(unlist(synfaxgtfs::get_settings('mode_numbers'))),
day =  'monday',
city = unname(unlist(synfaxgtfs::get_settings('city'))))
isochrone_params = list(start_time_ = synfaxgtfs::get_settings('start_time_')[[1]][1],
time_limit_ = synfaxgtfs::get_settings('time_limit_')[[1]][1],
xfer_penalty_ = synfaxgtfs::get_settings('xfer_penalty_')[[1]][1] )
synfaxgtfs:::.preload_isochrone_data(gtfs_parameters, isochrone_params)
unique_stops = (unique(synfaxgtfs:::.pkgenv$gtfs_prefilter$stop_id))
arrival_time_dict = synfaxgtfs:::.pkgenv$arrival_time_dict
#.pkgenv = synfaxgtfs:::.pkgenv
load_place_registry(unique_stops, isochrone_params, arrival_time_dict)
.pkgenv = synfaxgtfs:::.pkgenv
.pkgenv$place_registry
.pkgenv$place_registry['14315']
.pkgenv$place_registry['14315'][[1]]
is_empty(.pkgenv$place_registry['14315'][[1]])
rm(.pkgenv)
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
library(future)
library(furrr)
synfaxgtfs::load_place_registry_parallel()
plan('default')
synfaxgtfs::load_place_registry_parallel
library(synfaxgtfs)
library(tidyverse)
library(data.table)
library(sf)
library(lubridate)
library(tictoc)
library(s2)
library(leaflet)
library(future)
library(furrr)
#synfax gtfs
gtfs_parameters =  list(mode_numbers = unname(unlist(synfaxgtfs::get_settings('mode_numbers'))),
day =  'monday',
city = unname(unlist(synfaxgtfs::get_settings('city'))))
isochrone_params = list(start_time_ = synfaxgtfs::get_settings('start_time_')[[1]][1],
time_limit_ = synfaxgtfs::get_settings('time_limit_')[[1]][1],
xfer_penalty_ = synfaxgtfs::get_settings('xfer_penalty_')[[1]][1] )
synfaxgtfs:::.preload_isochrone_data(gtfs_parameters, isochrone_params)
unique_stops = (unique(synfaxgtfs:::.pkgenv$gtfs_prefilter$stop_id))
arrival_time_dict = synfaxgtfs:::.pkgenv$arrival_time_dict
#.pkgenv = synfaxgtfs:::.pkgenv
load_place_registry_parallel(unique_stops, isochrone_params, arrival_time_dict)
